---
title: "Field and UAv Data Analysis"
author: "Anna Talucci"
date: "2/28/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Overview


# Pakcages
```{r}
library(tidyr)
library(dplyr)
library(ggplot2)
library(stringr)
library(lme4)
library(cowplot)
library(lme4)
library(lsmeans)
library(DHARMa)
```


# Field Data
```{r}
field_data = read.csv("../data/field_subset/field_data_all.csv")
```

```{r}
head(field_data)
```

## field Plot sizes

```{r}
field_data %>% group_by(site, transect) %>% 
  summarise(min(shrub_area_sampled_m2))
```

```{r}
field_data %>% group_by(site, transect) %>% 
  summarise(max(shrub_area_sampled_m2))
```

```{r}
field_data %>% group_by(site, transect) %>% 
  summarise(min(tree_radius))
```

```{r}
field_data %>% group_by(site, transect) %>% 
  summarise(max(tree_radius))
```

# UAV Data

```{r}
gcc_all = read.csv("../data/extracted_data/gcc_all.csv", strip.white = TRUE)
ndvi_all = read.csv("../data/extracted_data/ndvi_all.csv", strip.white = TRUE)
```

```{r}
head(gcc_all)
head(ndvi_all)
```

# Combine Field and UAV data

```{r}
gcc_ndvi = merge(gcc_all, ndvi_all, by="ID")
gcc_ndvi
field_gcc = merge(field_data, gcc_all, by="ID") 
field_gcc
field_gcc_ndvi = merge(field_data, gcc_ndvi,  "ID")
field_gcc_ndvi
```

# Define grpah Theme and color Palette 

```{r}
comp_theme = theme_bw() + theme(legend.position = "none") +  
  theme(panel.grid.major = element_blank()) +
    theme(axis.title.y = element_text(size = 11, hjust = 0.5, vjust = 1.1),
        axis.text.x = element_text(size = 10, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.line = element_line(colour = "black"))
```
 
```{r}

reg_theme = theme_bw() + theme(legend.position = "none") +
  theme(plot.margin = unit(c(t = 0.3, r = 0.3, b = 0.3, l = 0.1), "cm")) +
  theme(axis.title.x = element_text(size = 11, hjust = 0.5, vjust = -0.1),
        axis.title.y = element_text(size = 11, hjust = 0.5, vjust = 1.1),
        axis.text.x = element_text(size = 10, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        panel.background = element_blank(), 
        axis.line = element_line(colour = "black"))

```

```{r}
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

# Data visualization


```{r}
ggplot(data = field_gcc, aes(x = plot_dis , y = mean_gcc_25cm, color = factor(transect_ID))) +
         geom_point(size = 3) +
         scale_color_manual(values=cbbPalette) +
          ylab("mean gcc (25cm)") +
          xlab("distance from edge")  +
          theme_bw() 
```

```{r}
ggplot(data = field_gcc, aes(x = transect_ID , y = shrub_total_ba, color = factor(transect_ID))) +
  geom_boxplot() +       
  geom_point() +
         scale_color_manual(values=cbbPalette) +
          ylab("shrub basal area") +
          xlab("Transect ID")  +
           theme_bw() + theme(legend.position = "bottom") +
  theme(plot.margin = unit(c(t = 0.3, r = 0.1, b = 0.3, l = 0.1), "cm")) +
  theme(axis.title.x = element_text(size = 11, hjust = 0.5, vjust = -0.1),
        axis.title.y = element_text(size = 11, hjust = 0.5, vjust = 1.1),
        axis.text.x = element_blank(),
        axis.text.y = element_text(size = 10, color = "black"),
        panel.background = element_blank(), 
        axis.line = element_line(colour = "black")) + guides(color=guide_legend(override.aes=list(fill=NA), title = "Transect ID"))
```

```{r}
ggplot(data = field_gcc, aes(x = transect_ID , y = tree_total_ba, color = factor(transect_ID))) +
  geom_boxplot() +       
  geom_point() +
         scale_color_manual(values=cbbPalette) +
          ylab("Tree basal area") +
          xlab("Transect ID")  +
           theme_bw() + theme(legend.position = "bottom") +
  theme(plot.margin = unit(c(t = 0.3, r = 0.1, b = 0.3, l = 0.1), "cm")) +
  theme(axis.title.x = element_text(size = 11, hjust = 0.5, vjust = -0.1),
        axis.title.y = element_text(size = 11, hjust = 0.5, vjust = 1.1),
        axis.text.x = element_blank(),
        axis.text.y = element_text(size = 10, color = "black"),
        panel.background = element_blank(), 
        axis.line = element_line(colour = "black")) + guides(color=guide_legend(override.aes=list(fill=NA), title = "Transect ID"))
```

```{r}
ggplot(data = field_gcc, aes(x = transect_ID , y = prop_live, color = factor(transect_ID))) +
  geom_boxplot() +       
  geom_point() +
         scale_color_manual(values=cbbPalette) +
          ylab("Proportion live trees") +
          xlab("Transect ID")  +
           theme_bw() + theme(legend.position = "bottom") +
  theme(plot.margin = unit(c(t = 0.3, r = 0.1, b = 0.3, l = 0.1), "cm")) +
  theme(axis.title.x = element_text(size = 11, hjust = 0.5, vjust = -0.1),
        axis.title.y = element_text(size = 11, hjust = 0.5, vjust = 1.1),
        axis.text.x = element_blank(),
        axis.text.y = element_text(size = 10, color = "black"),
        panel.background = element_blank(), 
        axis.line = element_line(colour = "black")) + guides(color=guide_legend(override.aes=list(fill=NA), title = "Transect ID"))
```


Boxplot with points
```{r}
ggplot(data = field_gcc, aes(x = transect_ID , y = mean_gcc_25cm, color = factor(transect_ID))) +
  geom_boxplot() +       
  geom_point() +
         scale_color_manual(values=cbbPalette) +
          ylab("mean gcc (25cm)") +
          xlab("Transect ID")  +
           theme_bw() + theme(legend.position = "bottom") +
  theme(plot.margin = unit(c(t = 0.3, r = 0.1, b = 0.3, l = 0.1), "cm")) +
  theme(axis.title.x = element_text(size = 11, hjust = 0.5, vjust = -0.1),
        axis.title.y = element_text(size = 11, hjust = 0.5, vjust = 1.1),
        axis.text.x = element_blank(),
        axis.text.y = element_text(size = 10, color = "black"),
        panel.background = element_blank(), 
        axis.line = element_line(colour = "black")) + guides(color=guide_legend(override.aes=list(fill=NA), title = "Transect ID"))
```
```{r}
ggplot(data = field_gcc_ndvi, aes(x = mean_ndvi_25cm , y = mean_ndvi_25cm, color = factor(transect_ID))) +
         geom_point(size = 3) +
         scale_color_manual(values=cbbPalette) +
          ylab("mean ndvi (25cm)") +
          xlab("")  +
          theme_bw() 
```

```{r}
ggplot(data = field_gcc_ndvi, aes(x = mean_gcc_25cm , y = mean_ndvi_25cm, color = factor(transect_ID))) +
         geom_point(size = 3) +
         scale_color_manual(values=cbbPalette) +
          ylab("mean ndvi (25cm)") +
          xlab("mean gcc (25cm)")  +
          theme_bw() 
```

```{r}
ggplot(data = field_gcc, aes(x = plot_dis , y = mean_gcc_1m, color = factor(burn_year))) +
         geom_point(size = 3) +
         scale_color_manual(values=c("#000000", "#E69F00", "#56B4E9", "#009E73")) +
          ylab("mean gcc (1m)") +
          xlab("distance from edge")  +
          theme_bw() 
```

```{r}
ggplot(data = field_gcc, aes(x = plot_dis , y = mean_gcc_3m, color = factor(burn_year))) +
         geom_point(size = 3) +
         scale_color_manual(values=c("#000000", "#E69F00", "#56B4E9", "#009E73")) +
          ylab("mean gcc (3m)") +
          xlab("distance from edge")  +
          theme_bw() 
```

```{r}
ggplot(data = field_gcc, aes(x = prop_live , y = mean_gcc_tree, color = factor(burn_year))) +
         geom_point(size = 3) +
         scale_color_manual(values=c("#000000", "#E69F00", "#56B4E9", "#009E73")) +
          ylab("mean gcc") +
          xlab("proportion live trees")  +
          theme_bw() 
```


```{r}
ggplot(data = shrubs_gcc, aes(x = shrub_ct , y = mean_gcc_shrub, color = factor(burn_year))) +
         geom_point(size = 3) +
         scale_color_manual(values=c("#000000", "#E69F00", "#56B4E9", "#009E73")) +
          ylab("mean gcc") +
          xlab("shrub abundance")  +
          theme_bw() 
```

# Analysis: 

# Part 1: GCC relates to NDVI

Assess spatial scale...


## 1. Model: NDVIas  function of GCC
```{r}
mod1 = glm(mean_ndvi_25cm ~ mean_gcc_25cm, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod1.res = simulateResiduals(fittedModel = mod1, n = 500)
mod1.res$scaledResiduals
mod1.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod1.res)
```

```{r}
testDispersion(mod1.res)
```

### Sumamry
```{r}
summary(mod1)
```

```{r}
data.frame(summary(lsmeans(mod1, ~ mean_gcc_25cm), type = "response"))
```

### Data for graph
```{r}
preddat_mod1 = data.frame(mean_gcc_25cm = field_gcc_ndvi$mean_gcc_25cm)

head(preddat_mod1)

pred_mod1 = predict(mod1, newdata = preddat_mod1, se.fit = TRUE)

UL_mod1 = with(pred_mod1, fit + 2*se.fit)
LL_mod1 = with(pred_mod1, fit - 2*se.fit)

field_gcc_ndvi1 = mutate(field_gcc_ndvi, pred_mod1 = pred_mod1$fit, 
               ucl_mod1 = UL_mod1, 
               lcl_mod1 = LL_mod1)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod1 = ggplot(data = field_gcc_ndvi1, aes(x = mean_gcc_25cm, y = mean_ndvi_25cm)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod1), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod1, ymax = ucl_mod1, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod1), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod1), linetype='longdash', size = 1) +
    
    ylab("Mean NDVI") +
    xlab("Mean GCC")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod1
```


## 2. Model: NDVIas  function of GCC
```{r}
mod2 = glm(mean_ndvi_50cm ~ mean_gcc_50cm, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod2.res = simulateResiduals(fittedModel = mod2, n = 500)
mod2.res$scaledResiduals
mod2.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod2.res)
```

```{r}
testDispersion(mod2.res)
```

### Sumamry
```{r}
summary(mod2)
```

```{r}
data.frame(summary(lsmeans(mod2, ~ mean_gcc_50cm), type = "response"))
```

### Data for graph
```{r}
preddat_mod2 = data.frame(mean_gcc_50cm = field_gcc_ndvi$mean_gcc_50cm)

head(preddat_mod2)

pred_mod2 = predict(mod2, newdata = preddat_mod2, se.fit = TRUE)

UL_mod2 = with(pred_mod2, fit + 2*se.fit)
LL_mod2 = with(pred_mod2, fit - 2*se.fit)

field_gcc_ndvi2 = mutate(field_gcc_ndvi, pred_mod2 = pred_mod2$fit, 
               ucl_mod2 = UL_mod2, 
               lcl_mod2 = LL_mod2)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod2 = ggplot(data = field_gcc_ndvi2, aes(x = mean_gcc_50cm, y = mean_ndvi_50cm)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod2), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod2, ymax = ucl_mod2, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod2), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod2), linetype='longdash', size = 1) +
    
    ylab("Mean NDVI") +
    xlab("Mean GCC")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod2
```

## 3. Model: NDVIas  function of GCC
```{r}
mod3 = glm(mean_ndvi_1m ~ mean_gcc_1m, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod3.res = simulateResiduals(fittedModel = mod3, n = 500)
mod3.res$scaledResiduals
mod3.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod3.res)
```

```{r}
testDispersion(mod3.res)
```

### Sumamry
```{r}
summary(mod3)
```

```{r}
data.frame(summary(lsmeans(mod3, ~ mean_gcc_1m), type = "response"))
```

### Data for graph
```{r}
preddat_mod3 = data.frame(mean_gcc_1m = field_gcc_ndvi$mean_gcc_1m)

head(preddat_mod3)

pred_mod3 = predict(mod3, newdata = preddat_mod3, se.fit = TRUE)

UL_mod3 = with(pred_mod3, fit + 2*se.fit)
LL_mod3 = with(pred_mod3, fit - 2*se.fit)

field_gcc_ndvi3 = mutate(field_gcc_ndvi, pred_mod3 = pred_mod3$fit, 
               ucl_mod3 = UL_mod3, 
               lcl_mod3 = LL_mod3)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod3 = ggplot(data = field_gcc_ndvi3, aes(x = mean_gcc_1m, y = mean_ndvi_1m)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod3), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod3, ymax = ucl_mod3, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod3), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod3), linetype='longdash', size = 1) +
    
    ylab("Mean NDVI") +
    xlab("Mean GCC")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod3
```

## 4. Model: NDVIas  function of GCC
```{r}
mod4 = glm(mean_ndvi_3m ~ mean_gcc_3m, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod4.res = simulateResiduals(fittedModel = mod4, n = 500)
mod4.res$scaledResiduals
mod4.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod4.res)
```

```{r}
testDispersion(mod4.res)
```

### Sumamry
```{r}
summary(mod4)
```

```{r}
data.frame(summary(lsmeans(mod4, ~ mean_gcc_3m), type = "response"))
```

### Data for graph
```{r}
preddat_mod4 = data.frame(mean_gcc_3m = field_gcc_ndvi$mean_gcc_3m)

head(preddat_mod4)

pred_mod4 = predict(mod4, newdata = preddat_mod4, se.fit = TRUE)

UL_mod4 = with(pred_mod4, fit + 2*se.fit)
LL_mod4 = with(pred_mod4, fit - 2*se.fit)

field_gcc_ndvi4 = mutate(field_gcc_ndvi, pred_mod4 = pred_mod4$fit, 
               ucl_mod4 = UL_mod4, 
               lcl_mod4 = LL_mod4)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod4 = ggplot(data = field_gcc_ndvi4, aes(x = mean_gcc_3m, y = mean_ndvi_3m)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod4), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod4, ymax = ucl_mod4, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod4), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod4), linetype='longdash', size = 1) +
    
    ylab("Mean NDVI") +
    xlab("Mean GCC")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod4
```

## 5. Model: NDVIas  function of GCC
```{r}
mod5 = glm(mean_ndvi_5m ~ mean_gcc_5m, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod5.res = simulateResiduals(fittedModel = mod5, n = 500)
mod5.res$scaledResiduals
mod5.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod5.res)
```

```{r}
testDispersion(mod5.res)
```

### Sumamry
```{r}
summary(mod5)
```

```{r}
data.frame(summary(lsmeans(mod5, ~ mean_gcc_5m), type = "response"))
```

### Data for graph
```{r}
preddat_mod5 = data.frame(mean_gcc_5m = field_gcc_ndvi$mean_gcc_5m)

head(preddat_mod5)

pred_mod5 = predict(mod5, newdata = preddat_mod5, se.fit = TRUE)

UL_mod5 = with(pred_mod5, fit + 2*se.fit)
LL_mod5 = with(pred_mod5, fit - 2*se.fit)

field_gcc_ndvi5 = mutate(field_gcc_ndvi, pred_mod5 = pred_mod5$fit, 
               ucl_mod5 = UL_mod5, 
               lcl_mod5 = LL_mod5)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod5 = ggplot(data = field_gcc_ndvi5, aes(x = mean_gcc_5m, y = mean_ndvi_5m)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod5), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod5, ymax = ucl_mod5, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod5), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod5), linetype='longdash', size = 1) +
    
    ylab("Mean NDVI") +
    xlab("Mean GCC")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod5
```

## 6. Model: NDVIas  function of GCC
```{r}
mod6 = glm(mean_ndvi_10m ~ mean_gcc_10m, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod6.res = simulateResiduals(fittedModel = mod6, n = 500)
mod6.res$scaledResiduals
mod6.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod6.res)
```

```{r}
testDispersion(mod6.res)
```

### Sumamry
```{r}
summary(mod6)
```

```{r}
data.frame(summary(lsmeans(mod6, ~ mean_gcc_10m), type = "response"))
```

### Data for graph
```{r}
preddat_mod6 = data.frame(mean_gcc_10m = field_gcc_ndvi$mean_gcc_10m)

head(preddat_mod6)

pred_mod6 = predict(mod6, newdata = preddat_mod6, se.fit = TRUE)

UL_mod6 = with(pred_mod6, fit + 2*se.fit)
LL_mod6 = with(pred_mod6, fit - 2*se.fit)

field_gcc_ndvi6 = mutate(field_gcc_ndvi, pred_mod6 = pred_mod6$fit, 
               ucl_mod6 = UL_mod6, 
               lcl_mod6 = LL_mod6)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod6 = ggplot(data = field_gcc_ndvi6, aes(x = mean_gcc_10m, y = mean_ndvi_10m)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod6), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod6, ymax = ucl_mod6, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod6), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod6), linetype='longdash', size = 1) +
    
    ylab("Mean NDVI") +
    xlab("Mean GCC")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod6
```

# Part 2:  Post-fire

## 15. Model: GCC 
```{r}
mod15 = glm(mean_gcc_25cm ~ burn_year:burn_unburn, data = field_gcc, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod15.res = simulateResiduals(fittedModel = mod15, n = 500)
mod15.res$scaledResiduals
mod15.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod15.res)
```

```{r}
testDispersion(mod15.res)
```

### Sumamry
```{r}
summary(mod15)
```


```{r}
with(summary(mod15), 1 - deviance/null.deviance)
```

### Data for Graph

```{r}
(mod15_graph = data.frame(summary(lsmeans(mod15, ~ burn_year:burn_unburn),type = "response")))
```



### Graph 

```{r}
plot_mod15 = ggplot(data = mod15_graph, aes(x = burn_year, y = lsmean, color = burn_unburn) ) + 
   geom_errorbar(width = .2, lwd = .75, aes(ymin = asymp.LCL, ymax = asymp.UCL), position = position_dodge(width = .75)) + 
geom_point(size = 3, position = position_dodge(width = .75)) + 
  labs(x=("Burn year"), y= "Mean GCC") +
  scale_color_manual(values = c("#E69F00", "#009E73")) + 
  comp_theme 

plot_mod15  
```

## 16. Model: NDVI as a function of burn year
```{r}
mod16 = glm(mean_ndvi_25cm ~ burn_year:burn_unburn, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod16.res = simulateResiduals(fittedModel = mod16, n = 500)
mod16.res$scaledResiduals
mod16.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod16.res)
```

```{r}
testDispersion(mod16.res)
```

### Sumamry
```{r}
summary(mod16)
```

### Data for Graph

```{r}
(mod16_graph = data.frame(summary(lsmeans(mod16, ~ burn_year:burn_unburn),type = "response")))
```




### Graph 

```{r}
plot_mod16 = ggplot(data = mod16_graph, aes(x = burn_year, y = lsmean, color = burn_unburn) ) + 
   geom_errorbar(width = .2, lwd = .75, aes(ymin = asymp.LCL, ymax = asymp.UCL), position = position_dodge(width = .75)) + 
geom_point(size = 3, position = position_dodge(width = .75)) + 
  labs(x=("Burn year"), y= "Mean NDVI") +
   scale_color_manual(values = c("#E69F00", "#009E73")) + 
  comp_theme 

plot_mod16  
```



# Part 2: Distance from Unburned

## 1. Model: GCC distance from eadge
```{r}
mod1 = glm(mean_gcc_25cm ~ plot_dis:burn_year, data = field_gcc, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod1.res = simulateResiduals(fittedModel = mod1, n = 500)
mod1.res$scaledResiduals
mod1.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod1.res)
```

```{r}
testDispersion(mod1.res)
```

### Sumamry
```{r}
summary(mod1)
```


```{r}
with(summary(mod1), 1 - deviance/null.deviance)
```

```{r}
(mod1_sum = data.frame(summary(lsmeans(mod1, ~ plot_dis:burn_year),type = "response")))
```

### Predicted data for for graph
```{r}
preddat_mod1 = data.frame(plot_dis = field_gcc$plot_dis, burn_year = field_gcc$burn_year)

head(preddat_mod1)

pred_mod1 = predict(mod1, newdata = preddat_mod1, se.fit = TRUE)

UL_mod1 = with(pred_mod1, fit + 2*se.fit)
LL_mod1 = with(pred_mod1, fit - 2*se.fit)

field_gcc1 = mutate(field_gcc, pred_mod1 = (pred_mod1$fit), 
               ucl_mod1 = (UL_mod1), 
               lcl_mod1 = (LL_mod1))
```


### Graph  

```{r}
plot_mod1 = ggplot(data = field_gcc1, aes(x = plot_dis, y = mean_gcc_25cm, color = factor(burn_year) )) + 
    geom_line(aes(y = pred_mod1, color = factor(burn_year)), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod1, ymax = ucl_mod1, fill = burn_year, color = NULL, show.legend = FALSE), alpha = .15) +
    scale_fill_manual(values=c("#000000", "#E69F00", "#56B4E9", "#009E73"), guide = FALSE) + 
    geom_line(aes(y= lcl_mod1, color = factor(burn_year)), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod1, color = factor(burn_year)), linetype='longdash', size = 1) +
    scale_color_manual(values=c("#000000", "#E69F00", "#56B4E9", "#009E73")) + 
    ylab("Mean GCC (25cm)") +
    xlab("Distance from edge (m)")  +
    reg_theme + guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod1
```

### Legend
```{r}
legend1 = ggplot(data = field_gcc1, aes(x = plot_dis, y = mean_gcc_25cm, color = factor(burn_year) )) + 
    geom_line(aes(y = pred_mod1, color = factor(burn_year)), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod1, ymax = ucl_mod1, fill = burn_year, color = NULL, show.legend = FALSE), alpha = .15) +
    scale_fill_manual(values=c("#000000", "#E69F00", "#56B4E9", "#009E73"), guide = FALSE) + 
    geom_line(aes(y= lcl_mod1, color = factor(burn_year)), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod1, color = factor(burn_year)), linetype='longdash', size = 1) +
    scale_color_manual(values=c("#000000", "#E69F00", "#56B4E9", "#009E73")) + 
    ylab("Mean GCC (25cm)") +
    xlab("Distance from edge (m)")  +
     theme_bw() + theme(legend.position = "bottom") +
  theme(plot.margin = unit(c(t = 0.3, r = 0.1, b = 0.3, l = 0.1), "cm")) +
  theme(axis.title.x = element_text(size = 11, hjust = 0.5, vjust = -0.1),
        axis.title.y = element_text(size = 11, hjust = 0.5, vjust = 1.1),
        axis.text.x = element_text(size = 10, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        panel.background = element_blank(), 
        axis.line = element_line(colour = "black")) + guides(color=guide_legend(override.aes=list(fill=NA), title = "Year of burn")) 
legend1
```



## 6.  Model: NDVI distance from edge
canopymod1 = glmer(canopy2 ~ mortality + burncon + (1 | id), data = biomass, family = binomial(link = "logit"))
```{r}
mod6 = glm(mean_ndvi_25cm ~ plot_dis:burn_year, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod6.res = simulateResiduals(fittedModel = mod6, n = 500)
mod6.res$scaledResiduals
mod6.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod6.res)
```

```{r}
testDispersion(mod6.res)
```

### Sumamry
```{r}
summary(mod6)
```


```{r}
with(summary(mod16), 1 - deviance/null.deviance)
```

```{r}
preddat_mod6 = data.frame(plot_dis = field_gcc_ndvi$plot_dis, burn_year = field_gcc_ndvi$burn_year)

head(preddat_mod6)

pred_mod6 = predict(mod6, newdata = preddat_mod6, se.fit = TRUE)

UL_mod6 = with(pred_mod6, fit + 2*se.fit)
LL_mod6 = with(pred_mod6, fit - 2*se.fit)

field_gcc_ndvi1 = mutate(field_gcc_ndvi, pred_mod6 = (pred_mod6$fit), 
               ucl_mod6 = (UL_mod6), 
               lcl_mod6 = (LL_mod6))
```


### Graph
```{r}
plot_mod6 = ggplot(data = field_gcc_ndvi1, aes(x = plot_dis, y = mean_gcc_25cm, color = factor(burn_year) )) + 
    geom_line(aes(y = pred_mod6, color = factor(burn_year)), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod6, ymax = ucl_mod6, fill = burn_year, color = NULL, show.legend = FALSE), alpha = .15) +
    scale_fill_manual(values=c("#E69F00", "#56B4E9"), guide = FALSE) + 
    geom_line(aes(y= lcl_mod6, color = factor(burn_year)), linetype = 'longdash', size = 1) + 
    geom_line(aes(y= ucl_mod6, color = factor(burn_year)), linetype='longdash', size = 1) +
    scale_color_manual(values=c("#E69F00", "#56B4E9")) + 
    ylab("Mean NDVI (25cm)") +
    xlab("Distance from edge (m)")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod6
```


## 17. Model: GCC distance from eadge only
```{r}
mod17 = glm(mean_gcc_25cm ~ plot_dis, data = field_gcc, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod17.res = simulateResiduals(fittedModel = mod1, n = 500)
mod17.res$scaledResiduals
mod17.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod17.res)
```

```{r}
testDispersion(mod17.res)
```

### Sumamry
```{r}
summary(mod17)
```

```{r}
(mod17_sum = data.frame(summary(lsmeans(mod17, ~ plot_dis),type = "response")))
```

### Predicted data for for graph
```{r}
preddat_mod17 = data.frame(plot_dis = field_gcc$plot_dis)

head(preddat_mod17)

pred_mod17 = predict(mod17, newdata = preddat_mod17, se.fit = TRUE)

UL_mod17 = with(pred_mod17, fit + 2*se.fit)
LL_mod17 = with(pred_mod17, fit - 2*se.fit)

field_gcc17 = mutate(field_gcc, pred_mod17 = (pred_mod17$fit), 
               ucl_mod17 = (UL_mod17), 
               lcl_mod17 = (LL_mod17))
```


### Graph  

```{r}
plot_mod17 = ggplot(data = field_gcc17, aes(x = plot_dis, y = mean_gcc_25cm)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod17), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod17, ymax = ucl_mod17, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod17), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod17), linetype='longdash', size = 1) +
    geom_vline(xintercept=0, linetype="dashed", color = "#9C270E", size = 1) +
    ylab("Mean GCC") +
    xlab("Distance from edge")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod17
```


## 18.  Model: NDVI distance from edge
canopymod1 = glmer(canopy2 ~ mortality + burncon + (1 | id), data = biomass, family = binomial(link = "logit"))
```{r}
mod18 = glm(mean_ndvi_25cm ~ plot_dis, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod18.res = simulateResiduals(fittedModel = mod18, n = 500)
mod18.res$scaledResiduals
mod18.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod18.res)
```

```{r}
testDispersion(mod18.res)
```

### Sumamry
```{r}
summary(mod18)
```

```{r}
(mod18_sum = data.frame(summary(lsmeans(mod18, ~ plot_dis),type = "response")))
```

```{r}
preddat_mod18 = data.frame(plot_dis = field_gcc_ndvi$plot_dis)

head(preddat_mod18)

pred_mod18 = predict(mod18, newdata = preddat_mod18, se.fit = TRUE)

UL_mod18 = with(pred_mod18, fit + 2*se.fit)
LL_mod18 = with(pred_mod18, fit - 2*se.fit)

field_gcc_ndvi18 = mutate(field_gcc_ndvi, pred_mod18 = (pred_mod18$fit), 
               ucl_mod18 = (UL_mod18), 
               lcl_mod18 = (LL_mod18))
```

### Graph  

```{r}
plot_mod18 = ggplot(data = field_gcc_ndvi18, aes(x = plot_dis, y = mean_ndvi_25cm)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod18), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod18, ymax = ucl_mod18, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod18), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod18), linetype='longdash', size = 1) +
    geom_vline(xintercept=0, linetype="dashed", color = "#9C270E", size = 1) +
    ylab("Mean NDVI") +
    xlab("Distance from edge")  +
    reg_theme + guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod18
```

# Part 3: Burned and Unburned

## 2. Model: GCC burn/unburned
```{r}
mod2 = glm(mean_gcc_25cm ~ burn_unburn, data = site_gcc, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod2.res = simulateResiduals(fittedModel = mod2, n = 500)
mod2.res$scaledResiduals
mod2.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod2.res)
```

```{r}
testDispersion(mod2.res)
```

### Sumamry
```{r}
summary(mod2)
```

### Data for graph

```{r}
(mod2_graph = data.frame(summary(lsmeans(mod2, pairwise ~ burn_unburn),type = "response")))
```

```{r}
levels(mod2_graph$lsmeans.burn_unburn)[levels(mod2_graph$lsmeans.burn_unburn)=="burned"] = "Burned"
levels(mod2_graph$lsmeans.burn_unburn)[levels(mod2_graph$lsmeans.burn_unburn)=="unburned"] = "Unburned"

( mod2_graph1 = dplyr::select(mod2_graph, lsmeans.burn_unburn:lsmeans.asymp.UCL))



names(mod2_graph1)[1:6] = c("burn_unburn", "response", "se", "df", "lcl", "ucl")
mod2_graph1 = data.frame(mod2_graph1)
mod2_graph1

```

### Graph

```{r}
plot_mod2 = ggplot(data = mod2_graph1, aes(x = burn_unburn, y = response, color = burn_unburn) ) + 
   geom_errorbar(width = .2, lwd = .75, aes(ymin = lcl, ymax = ucl), position = position_dodge(width = .75)) + 
geom_point(size = 3, position = position_dodge(width = .75)) + 
  labs(x=(NULL), y= "Mean GCC") +
  scale_color_manual(values = c("#E69F00", "#009E73")) + 
  comp_theme

plot_mod2 
```


## 7. Model: NDVI burn/unburned
```{r}
mod7 = glm(mean_ndvi_25cm ~ burn_unburn, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod7.res = simulateResiduals(fittedModel = mod7, n = 500)
mod7.res$scaledResiduals
mod7.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod7.res)
```

```{r}
testDispersion(mod7.res)
```

### Sumamry
```{r}
summary(mod7)
```

### Data for graph

```{r}
(mod7_graph = data.frame(summary(lsmeans(mod7, pairwise ~ burn_unburn),type = "response")))
```

```{r}
levels(mod7_graph$lsmeans.burn_unburn)[levels(mod7_graph$lsmeans.burn_unburn)=="burned"] = "Burned"
levels(mod7_graph$lsmeans.burn_unburn)[levels(mod7_graph$lsmeans.burn_unburn)=="unburned"] = "Unburned"

( mod7_graph1 = dplyr::select(mod7_graph, lsmeans.burn_unburn:lsmeans.asymp.UCL))



names(mod7_graph1)[1:6] = c("burn_unburn", "response", "se", "df", "lcl", "ucl")
mod7_graph1 = data.frame(mod7_graph1)
mod7_graph1

```

### Graph

```{r}
plot_mod7 = ggplot(data = mod7_graph1, aes(x = burn_unburn, y = response, color = burn_unburn) ) + 
   geom_errorbar(width = .2, lwd = .75, aes(ymin = lcl, ymax = ucl), position = position_dodge(width = .75)) + 
geom_point(size = 3, position = position_dodge(width = .75)) + 
  labs(x=(NULL), y= "Mean NDVI") +
  scale_color_manual(values = c("#E69F00", "#009E73")) + 
  comp_theme

plot_mod7 
```



# Part 4: Vegetation cover

## 5. Model: GCC proportion of Live trees

```{r}
mod5 = glm(mean_gcc_tree ~ prop_live, data = field_gcc, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod5.res = simulateResiduals(fittedModel = mod5, n = 500)
mod5.res$scaledResiduals
mod5.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod5.res)
```

```{r}
testDispersion(mod5.res)
```

### Sumamry
```{r}
summary(mod5)
```

### Data for graph
```{r}
lsmeans(mod5, ~ prop_live)

```

```{r}
(mod5_graph = data.frame(summary(lsmeans(mod5, ~ prop_live), type = "response")))
```



```{r}
preddat5 = data.frame(prop_live = field_gcc$prop_live)

head(preddat5)

pred5 = predict(mod5, newdata = preddat5, se.fit = TRUE)

UL5 = with(pred5, fit + 2*se.fit)
LL5 = with(pred5, fit - 2*se.fit)

field_gcc5 = mutate(field_gcc, pred5 = pred5$fit, 
               ucl_mod5 = UL5, 
               lcl_mod5 = LL5)
```

```{r}
min(field_gcc$mean_gcc_tree)
mean(field_gcc$tree_area_sampled_m2)
min(field_gcc$tree_area_sampled_m2)
median(field_gcc$tree_area_sampled_m2)
max(field_gcc$tree_area_sampled_m2)
```
### Graph

```{r}
plot_mod5 = ggplot(data = field_gcc5, aes(x = prop_live, y = mean_gcc_tree)) + 
    geom_line(aes(y = pred5), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod5, ymax = ucl_mod5, color = NULL), alpha = .15) +
    geom_line(aes(y= lcl_mod5), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod5), linetype='longdash', size = 1) +
    ylab("Mean GCC") +
    xlab("Proportion of live trees")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod5
```


## 9. Model: GCC tree  BA
```{r}
mod9 = glm(mean_gcc_tree ~ total_ba, data = field_gcc, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod9.res = simulateResiduals(fittedModel = mod9, n = 500)
mod9.res$scaledResiduals
mod9.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod9.res)
```

```{r}
testDispersion(mod9.res)
```

### Sumamry
```{r}
summary(mod9)
```

### Data for graph

```{r}
(mod9_graph = data.frame(summary(lsmeans(mod9, ~ total_ba),type = "response")))
```

```{r}

names(mod9_graph)[5:6] = c("lcl", "ucl")
mod9_graph1 = data.frame(mod9_graph)
mod9_graph1

```

```{r}
preddat_mod9 = data.frame(total_ba = field_gcc$total_ba)

head(preddat_mod9)

pred_mod9 = predict(mod9, newdata = preddat_mod9, se.fit = TRUE)

UL_mod9 = with(pred_mod9, fit + 2*se.fit)
LL_mod9 = with(pred_mod9, fit - 2*se.fit)

field_gcc1 = mutate(field_gcc, pred_mod9 = pred_mod9$fit, 
               ucl_mod9 = UL_mod9, 
               lcl_mod9 = LL_mod9)
```

### Graph

```{r}
plot_mod9 = ggplot(data = field_gcc1, aes(x = total_ba, y = mean_gcc_tree)) + 
    geom_line(aes(y = pred_mod9), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod9, ymax = ucl_mod9, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod9), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod9), linetype='longdash', size = 1) +
    ylab("Mean GCC") +
    xlab("Tree total basal area" ~(m^2))  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod9
```

## 12. Model: GCC shrub  BA



```{r}
mod12 = glm(mean_gcc_shrub ~ total_ba, data = field_gcc, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod12.res = simulateResiduals(fittedModel = mod12, n = 500)
mod12.res$scaledResiduals
mod12.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot tofall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod12.res)
```

```{r}
testDispersion(mod12.res)
```

### Sumamry
```{r}
summary(mod12)
```

### Data for graph

```{r}
(mod12_graph = data.frame(summary(lsmeans(mod12, ~ total_ba),type = "response")))
```

```{r}

names(mod12_graph)[5:6] = c("lcl", "ucl")
mod12_graph1 = data.frame(mod12_graph)
mod12_graph1

```

```{r}
preddat_mod12 = data.frame(shrub_total_ba = field_gcc$shrub_total_ba)

head(preddat_mod12)

pred_mod12 = predict(mod12, newdata = preddat_mod12, se.fit = TRUE)

UL_mod12 = with(pred_mod12, fit + 2*se.fit)
LL_mod12 = with(pred_mod12, fit - 2*se.fit)

field_gcc1 = mutate(field_gcc, pred_mod12 = pred_mod12$fit, 
               ucl_mod12 = UL_mod12, 
               lcl_mod12 = LL_mod12)
```

### Graph

```{r}
plot_mod12 = ggplot(data = field_gcc1, aes(x = total_ba, y = mean_gcc_tree)) + 
    geom_line(aes(y = pred_mod12), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod12, ymax = ucl_mod12, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod12), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod12), linetype='longdash', size = 1) +
    ylab("Mean GCC") +
    xlab("Shrub total basal area" ~(m^2))  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod12
```



## 10. Model: NDVI tree BA

```{r}
head(field_gcc_ndvi)
```


```{r}
mod10 = glm(mean_ndvi_tree ~ total_ba, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod10.res = simulateResiduals(fittedModel = mod10, n = 500)
mod10.res$scaledResiduals
mod10.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod10.res)
```

```{r}
testDispersion(mod10.res)
```

### Sumamry
```{r}
summary(mod10)
```

### Data for graph

```{r}
(mod10_graph = data.frame(summary(lsmeans(mod10, ~ total_ba),type = "response")))
```

```{r}

names(mod10_graph)[5:6] = c("lcl", "ucl")
mod10_graph1 = data.frame(mod10_graph)
mod10_graph1

```

```{r}
preddat_mod10 = data.frame(total_ba = field_gcc_ndvi$total_ba)

head(preddat_mod10)

pred_mod10 = predict(mod10, newdata = preddat_mod10, se.fit = TRUE)

UL_mod10 = with(pred_mod10, fit + 2*se.fit)
LL_mod10 = with(pred_mod10, fit - 2*se.fit)

field_gcc_ndvi10 = mutate(field_gcc_ndvi, pred_mod10 = pred_mod10$fit, 
               ucl_mod10 = UL_mod10, 
               lcl_mod10 = LL_mod10)
```

### Graph

```{r}
plot_mod10 = ggplot(data = field_gcc_ndvi10, aes(x = total_ba, y = mean_gcc_tree)) + 
    geom_line(aes(y = pred_mod10), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod10, ymax = ucl_mod10, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod10), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod10), linetype='longdash', size = 1) +
    ylab("Mean NDVI") +
    xlab("Tree total basal area"~(m^2))  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod10
```

## 13. Model: NDVI shrub BA


```{r}
max(field_gcc_ndvi$mean_ndvi_shrub)
min(field_gcc_ndvi$mean_ndvi_shrub)
```

```{r}
mod13 = glm(mean_ndvi_shrub ~ total_ba, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod13.res = simulateResiduals(fittedModel = mod13, n = 500)
mod13.res$scaledResiduals
mod13.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod13.res)
```

```{r}
testDispersion(mod13.res)
```

### Sumamry
```{r}
summary(mod13)
```

### Data for graph

```{r}
(mod13_graph = data.frame(summary(lsmeans(mod13, ~ total_ba),type = "response")))
```

```{r}

names(mod13_graph)[5:6] = c("lcl", "ucl")
mod13_graph1 = data.frame(mod13_graph)
mod13_graph1

```

```{r}
preddat_mod13 = data.frame(shrub_total_ba = field_gcc_ndvi$shrub_total_ba)

head(preddat_mod13)

pred_mod13 = predict(mod13, newdata = preddat_mod13, se.fit = TRUE)

UL_mod13 = with(pred_mod13, fit + 2*se.fit)
LL_mod13 = with(pred_mod13, fit - 2*se.fit)

field_gcc_ndvi1 = mutate(field_gcc_ndvi, pred_mod13 = pred_mod13$fit, 
               ucl_mod13 = UL_mod13, 
               lcl_mod13 = LL_mod13)
```

### Graph

```{r}
plot_mod13 = ggplot(data = field_gcc_ndvi1, aes(x = shrub_total_ba, y = mean_ndvi_shrub)) + 
    geom_line(aes(y = pred_mod13), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod13, ymax = ucl_mod13, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod13), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod13), linetype='longdash', size = 1) +
    ylab("Mean NDVI") +
    xlab("Shrub total basal area" ~(m^2))  +
    scale_y_continuous(breaks=c(0.05,0.1, 0.15)) +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod13
```


## 11. Model: NDVI proportion of Live trees



```{r}
mod11 = glm(mean_ndvi_tree ~ prop_live, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod11.res = simulateResiduals(fittedModel = mod11, n = 500)
mod11.res$scaledResiduals
mod11.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod11.res)
```

```{r}
testDispersion(mod11.res)
```

### Sumamry
```{r}
summary(mod11)
```

### Data for graph

```{r}
(mod11_graph = data.frame(summary(lsmeans(mod11, ~ prop_live), type = "response")))
```

```{r}

names(mod11_graph)[5:6] = c("lcl", "ucl")
mod11_graph1 = data.frame(mod11_graph)
mod11_graph1

```

```{r}
preddat11 = data.frame(prop_live = field_gcc_ndvi$prop_live)

head(preddat11)

pred11 = predict(mod11, newdata = preddat11, se.fit = TRUE)

UL11 = with(pred11, fit + 2*se.fit)
LL11 = with(pred11, fit - 2*se.fit)

field_gcc_ndvi1 = mutate(field_gcc_ndvi, pred11 = pred11$fit, 
               ucl_mod11 = UL11, 
               lcl_mod11 = LL11)
```


### Graph

```{r}
plot_mod11 = ggplot(data = field_gcc_ndvi1, aes(x = prop_live, y = mean_ndvi_tree)) + 
    geom_line(aes(y = pred11), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod11, ymax = ucl_mod11, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod11), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod11), linetype='longdash', size = 1) +
    ylab("Mean NDVI") +
    xlab("Proportion of live trees")  +
    scale_y_continuous(breaks=c(0.05,0.1, 0.15)) +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod11
```









# Panel Figures 


legend = cowplot::get_legend(legend3)
(cfgrid12 = plot_grid(cfgrid11, legend, ncol=1, rel_widths = c(1, .1), rel_heights = c(1, .05)) ) 
## Figure: distance from edge + Burn year
```{r fig.height=4, fig.width=6}
legend = cowplot::get_legend(legend1)
grid_plot16 = cowplot::plot_grid(plot_mod1, plot_mod6, labels = c("A", "B"), align = "hv", ncol= 2) 
grid_plot16
grid2_plot16 = plot_grid(grid_plot16, legend, ncol=1, rel_widths = c(1, .1), rel_heights = c(1, .1)) 
grid2_plot16
```
```{r eval=FALSE, include=FALSE}
ggsave("../figures/2020-03-02_distance-burnyr.jpeg", plot = grid2_plot16, width = 6, height = 4, units = c("in"), dpi=600 )
```

## Figure: Distance from edge

```{r fig.height=3, fig.width=6}

grid_plot1718 = cowplot::plot_grid(plot_mod17, plot_mod18, labels = c("A", "B"), align = "hv", ncol= 2) 
grid_plot1718

```

```{r eval=FALSE, include=FALSE}
ggsave("../figures/2020-03-11_distance_edge_pts.jpeg", plot = grid_plot1718, width = 6, height = 3, units = c("in"), dpi=600 )
```


## Figure: Burned vs. Unburned
```{r fig.height=3, fig.width=6}

grid_plot27 = cowplot::plot_grid(plot_mod2, plot_mod7, labels = c("A", "B"), align = "hv", ncol= 2) 
grid_plot27

```


```{r eval=FALSE, include=FALSE}
ggsave("../figures/2020-03-02_burn-unburn.jpeg", plot = grid_plot27, width = 6, height = 3, units = c("in"), dpi=600 )
```


## Figure: Burned vs. Unburned + Burn Year
```{r fig.height=6, fig.width=6}

grid_plot_comb1 = cowplot::plot_grid(plot_mod2, plot_mod7, plot_mod15, plot_mod16, labels = c("A", "B", "C", "D"), align = "hv", ncol= 2) 
grid_plot_comb1

```


```{r eval=FALSE, include=FALSE}
ggsave("../figures/2020-03-11_burn-unburn-year.jpeg", plot = grid_plot_comb1, width = 6, height = 6, units = c("in"), dpi=600 )
```


## Figure: TIme since burn
```{r fig.height=3, fig.width=6}

grid_plot_tsb = cowplot::plot_grid(plot_mod15, plot_mod16, labels = c("A", "B"), align = "hv", ncol= 2) 
grid_plot_tsb

```


```{r eval=FALSE, include=FALSE}
ggsave("../figures/2020-03-12_TimeSinceBurn.jpeg", plot = grid_plot_tsb, width = 6, height = 3, units = c("in"), dpi=600 )
```

##  Figure: Tree biomass
```{r fig.height=6, fig.width=6}
grid_plot591011 = cowplot::plot_grid(plot_mod5, plot_mod11, plot_mod9, plot_mod10,  labels = c("A", "B", "C", "D"), align = "hv", ncol= 2) 
grid_plot591011
```

```{r eval=FALSE, include=FALSE}
ggsave("../figures/2020-03-02_tree-gcc-ndvi.jpeg", plot = grid_plot591011, width = 6, height = 6, units = c("in"), dpi=600 )
```

##  Figure: shrub biomass
```{r fig.height=3, fig.width=6}

grid_plot1213 = cowplot::plot_grid(plot_mod12, plot_mod13,  labels = c("A", "B"), align = "hv", ncol= 2) 
grid_plot1213

```

```{r eval=FALSE, include=FALSE}
ggsave("../figures/2020-03-02_shrub-gcc-ndvi.jpeg", plot = grid_plot1213, width = 6, height = 3, units = c("in"), dpi=600 )
```


## Figure: vegetation cover

```{r fig.height=7, fig.width=6}

grid_plot_veg = cowplot::plot_grid(plot_mod12, plot_mod13, plot_mod9, plot_mod10, plot_mod5, plot_mod11,   labels = c("A", "B", "C", "D", "E", "F"), align = "hv", ncol= 2) 
grid_plot_veg

```

```{r eval=FALSE, include=FALSE}
ggsave("../figures/2020-03-11_vegcover-gcc-ndvi.jpeg", plot = grid_plot_veg, width = 6, height = 7, units = c("in"), dpi=600 )
```

##  Figure: GCC and NDVI by transect
```{r fig.height=5, fig.width=6}

grid_plot314 = cowplot::plot_grid(plot_mod3, plot_mod14,  labels = c("A", "B"), align = "hv", nrow= 2) 
grid_plot314

```

```{r eval=FALSE, include=FALSE}
ggsave("../figures/2020-03-02_transect-gcc-ndvi.jpeg", plot = grid_plot314, width = 6, height = 3, units = c("in"), dpi=600 )
```