---
title: "UAV-Biomass-Tree-Analysis"
author: "Anna Talucci"
date: "5/13/2020"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Overview


# Pakcages
```{r}
library(tidyr)
library(dplyr)
library(ggplot2)
library(stringr)
library(lme4)
library(cowplot)
library(lme4)
library(lsmeans)
library(DHARMa)
library(rcompanion)
```


# Field Data
```{r}
field_data = read.csv("../data/field_subset/field_data_all.csv")
```

```{r}
head(field_data)
```

## field Plot sizes

```{r}
field_data %>% group_by(site, transect) %>% 
  summarise(min(shrub_plot_area))
```

```{r}
field_data %>% group_by(site, transect) %>% 
  summarise(max(shrub_plot_area))
```

```{r}
field_data %>% group_by(site, transect) %>% 
  summarise(min(tree_radius))
```

```{r}
field_data %>% group_by(site, transect) %>% 
  summarise(max(tree_radius))
```

# UAV Data

```{r}
gcc_all = read.csv("../data/extracted_data/gcc_all.csv", strip.white = TRUE)
ndvi_all = read.csv("../data/extracted_data/ndvi_all.csv", strip.white = TRUE)
```

```{r}
head(gcc_all)
head(ndvi_all)
```

# Combine Field and UAV data

```{r}
gcc_ndvi = merge(gcc_all, ndvi_all, by="ID")
gcc_ndvi
field_gcc = merge(field_data, gcc_all, by="ID") 
field_gcc
field_gcc_ndvi = merge(field_data, gcc_ndvi,  "ID")
field_gcc_ndvi
```

# burn_year as factor

```{r}
field_gcc$burn_year = as.factor(field_gcc$burn_year)
field_gcc_ndvi$burn_year = as.factor(field_gcc_ndvi$burn_year)

str(field_gcc)
str(field_gcc_ndvi)
```



# Define graph Theme and color Palette 

```{r}
comp_theme = theme_bw() + theme(legend.position = "none") +  
  theme(panel.grid.major = element_blank()) +
    theme(axis.title.y = element_text(size = 11, hjust = 0.5, vjust = 1.1),
        axis.text.x = element_text(size = 10, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.line = element_line(colour = "black"))
```
 
```{r}

reg_theme = theme_bw() + theme(legend.position = "none") +
  theme(plot.margin = unit(c(t = 0.3, r = 0.3, b = 0.3, l = 0.1), "cm")) +
  theme(axis.title.x = element_text(size = 11, hjust = 0.5, vjust = -0.1),
        axis.title.y = element_text(size = 11, hjust = 0.5, vjust = 1.1),
        axis.text.x = element_text(size = 10, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        panel.background = element_blank(), 
        axis.line = element_line(colour = "black"))

```

```{r}
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
```

# Analysis: 
```{r}
head(field_gcc)
```

# Part 4: Biomass as it relates to GCC and NDVI

## 1. Model: Woody Biomass function of GCC
```{r}
mod1 = glm(mean_gcc_25cm ~ tree_biomass_g_m, data = field_gcc, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod1.res = simulateResiduals(fittedModel = mod1, n = 500)
mod1.res$scaledResiduals
mod1.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod1.res)
```

```{r}
testDispersion(mod1.res)
```

### Sumamry
```{r}
summary(mod1)
```

```{r}
with(summary(mod1), 1 - (deviance/null.deviance))
```

```{r}
data.frame(summary(lsmeans(mod1, ~ tree_biomass_g_m), type = "response"))
```

### Data for graph

```{r}
preddat_mod1 = data.frame(tree_biomass_g_m = field_gcc$tree_biomass_g_m)

head(preddat_mod1)

pred_mod1 = predict(mod1, newdata = preddat_mod1, se.fit = TRUE)

UL_mod1 = with(pred_mod1, fit + 2*se.fit)
LL_mod1 = with(pred_mod1, fit - 2*se.fit)

field_gcc1 = mutate(field_gcc, pred_mod1 = pred_mod1$fit, 
               ucl_mod1 = UL_mod1, 
               lcl_mod1 = LL_mod1)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod1 = ggplot(data = field_gcc1, aes(x = tree_biomass_g_m, y = mean_gcc_25cm)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod1), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod1, ymax = ucl_mod1, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod1), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod1), linetype='longdash', size = 1) +
    
    ylab("Mean GCC (25cm)") +
    xlab("AGB (g per m^2)")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod1
```


## 2. Model: NDVIas  function of GCC
```{r}
mod2 = glm(mean_gcc_50cm ~ tree_biomass_g_m, data = field_gcc, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod2.res = simulateResiduals(fittedModel = mod2, n = 500)
mod2.res$scaledResiduals
mod2.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod2.res)
```

```{r}
testDispersion(mod2.res)
```

### Sumamry
```{r}
summary(mod2)
```

```{r}
with(summary(mod2), 1 - deviance/null.deviance)
```

```{r}
data.frame(summary(lsmeans(mod2, ~ tree_biomass_g_m), type = "response"))
```

### Data for graph
```{r}
preddat_mod2 = data.frame(tree_biomass_g_m = field_gcc$tree_biomass_g_m)

head(preddat_mod2)

pred_mod2 = predict(mod2, newdata = preddat_mod2, se.fit = TRUE)

UL_mod2 = with(pred_mod2, fit + 2*se.fit)
LL_mod2 = with(pred_mod2, fit - 2*se.fit)

field_gcc2 = mutate(field_gcc, pred_mod2 = pred_mod2$fit, 
               ucl_mod2 = UL_mod2, 
               lcl_mod2 = LL_mod2)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod2 = ggplot(data = field_gcc2, aes(x = tree_biomass_g_m, y = mean_gcc_50cm)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod2), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod2, ymax = ucl_mod2, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod2), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod2), linetype='longdash', size = 1) +
    
    ylab("Mean GCC (50cm)") +
    xlab("Biomass")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod2
```

## 3. Model: NDVIas  function of GCC
```{r}
mod3 = glm(mean_gcc_1m ~ tree_biomass_g_m, data = field_gcc, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod3.res = simulateResiduals(fittedModel = mod3, n = 500)
mod3.res$scaledResiduals
mod3.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod3.res)
```

```{r}
testDispersion(mod3.res)
```

### Sumamry
```{r}
summary(mod3)
```

```{r}
with(summary(mod3), 1 - deviance/null.deviance)
```

```{r}
data.frame(summary(lsmeans(mod3, ~ tree_biomass_g_m), type = "response"))
```

### Data for graph
```{r}
preddat_mod3 = data.frame(tree_biomass_g_m = field_gcc$tree_biomass_g_m)

head(preddat_mod3)

pred_mod3 = predict(mod3, newdata = preddat_mod3, se.fit = TRUE)

UL_mod3 = with(pred_mod3, fit + 2*se.fit)
LL_mod3 = with(pred_mod3, fit - 2*se.fit)

field_gcc3 = mutate(field_gcc, pred_mod3 = pred_mod3$fit, 
               ucl_mod3 = UL_mod3, 
               lcl_mod3 = LL_mod3)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod3 = ggplot(data = field_gcc3, aes(x = tree_biomass_g_m, y = mean_gcc_1m)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod3), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod3, ymax = ucl_mod3, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod3), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod3), linetype='longdash', size = 1) +
    
    ylab("Mean GCC (1m)") +
    xlab("biomass")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod3
```

## 4. Model: NDVIas  function of GCC
```{r}
mod4 = glm(mean_gcc_3m ~ tree_biomass_g_m, data = field_gcc, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod4.res = simulateResiduals(fittedModel = mod4, n = 500)
mod4.res$scaledResiduals
mod4.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod4.res)
```

```{r}
testDispersion(mod4.res)
```

### Sumamry
```{r}
summary(mod4)
```

```{r}
with(summary(mod4), 1 - deviance/null.deviance)
```

```{r}
data.frame(summary(lsmeans(mod4, ~ tree_biomass_g_m), type = "response"))
```

### Data for graph
```{r}
preddat_mod4 = data.frame(tree_biomass_g_m = field_gcc$tree_biomass_g_m)

head(preddat_mod4)

pred_mod4 = predict(mod4, newdata = preddat_mod4, se.fit = TRUE)

UL_mod4 = with(pred_mod4, fit + 2*se.fit)
LL_mod4 = with(pred_mod4, fit - 2*se.fit)

field_gcc4 = mutate(field_gcc, pred_mod4 = pred_mod4$fit, 
               ucl_mod4 = UL_mod4, 
               lcl_mod4 = LL_mod4)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod4 = ggplot(data = field_gcc4, aes(x = tree_biomass_g_m, y = mean_gcc_3m)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod4), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod4, ymax = ucl_mod4, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod4), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod4), linetype='longdash', size = 1) +
    
    ylab("Mean GCC (3m)") +
    xlab("Biomass")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod4
```

## 5. Model: NDVIas  function of GCC
```{r}
mod5 = glm(mean_gcc_5m ~ tree_biomass_g_m, data = field_gcc, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod5.res = simulateResiduals(fittedModel = mod5, n = 500)
mod5.res$scaledResiduals
mod5.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod5.res)
```

```{r}
testDispersion(mod5.res)
```

### Sumamry
```{r}
summary(mod5)
```

```{r}
with(summary(mod5), 1 - deviance/null.deviance)
```

```{r}
data.frame(summary(lsmeans(mod5, ~ tree_biomass_g_m), type = "response"))
```

### Data for graph
```{r}
preddat_mod5 = data.frame(tree_biomass_g_m = field_gcc$tree_biomass_g_m)

head(preddat_mod5)

pred_mod5 = predict(mod5, newdata = preddat_mod5, se.fit = TRUE)

UL_mod5 = with(pred_mod5, fit + 2*se.fit)
LL_mod5 = with(pred_mod5, fit - 2*se.fit)

field_gcc5 = mutate(field_gcc, pred_mod5 = pred_mod5$fit, 
               ucl_mod5 = UL_mod5, 
               lcl_mod5 = LL_mod5)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod5 = ggplot(data = field_gcc5, aes(x =tree_biomass_g_m, y = mean_gcc_5m)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod5), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod5, ymax = ucl_mod5, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod5), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod5), linetype='longdash', size = 1) +
    
    ylab("Mean NDVI (5m)") +
    xlab("Biomass")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 
plot_mod5
```

## 6. Model: NDVIas  function of GCC
```{r}
mod6 = glm(mean_gcc_10m ~ tree_biomass_g_m, data = field_gcc, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod6.res = simulateResiduals(fittedModel = mod6, n = 500)
mod6.res$scaledResiduals
mod6.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod6.res)
```

```{r}
testDispersion(mod6.res)
```

### Sumamry
```{r}
summary(mod6)
```

```{r}
with(summary(mod6), 1 - deviance/null.deviance)
```

```{r}
data.frame(summary(lsmeans(mod6, ~ tree_biomass_g_m), type = "response"))
```

### Data for graph

```{r}
preddat_mod6 = data.frame(tree_biomass_g_m = field_gcc$tree_biomass_g_m)

head(preddat_mod6)

pred_mod6 = predict(mod6, newdata = preddat_mod6, se.fit = TRUE)

UL_mod6 = with(pred_mod6, fit + 2*se.fit)
LL_mod6 = with(pred_mod6, fit - 2*se.fit)

field_gcc6 = mutate(field_gcc, pred_mod6 = pred_mod6$fit, 
               ucl_mod6 = UL_mod6, 
               lcl_mod6 = LL_mod6)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod6 = ggplot(data = field_gcc6, aes(x = tree_biomass_g_m, y = mean_gcc_10m)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod6), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod6, ymax = ucl_mod6, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod6), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod6), linetype='longdash', size = 1) +
    
    ylab("Mean GCC  (10m)") +
    xlab("Biomass")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod6
```

```{r}
compareGLM(mod1, mod2, mod3, mod4, mod5, mod6)
```

## 7. Model: NDVIas  function of GCC
```{r}
mod7 = glm(mean_ndvi_25cm ~ tree_biomass_g_m, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod7.res = simulateResiduals(fittedModel = mod7, n = 500)
mod7.res$scaledResiduals
mod7.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod7.res)
```

```{r}
testDispersion(mod7.res)
```

### Sumamry
```{r}
summary(mod7)
```

```{r}
with(summary(mod7), 1 - (deviance/null.deviance))
```

```{r}
data.frame(summary(lsmeans(mod7, ~ tree_biomass_g_m), type = "response"))
```

### Data for graph
```{r}
preddat_mod7 = data.frame(tree_biomass_g_m = field_gcc_ndvi$tree_biomass_g_m)

head(preddat_mod7)

pred_mod7 = predict(mod7, newdata = preddat_mod7, se.fit = TRUE)

UL_mod7 = with(pred_mod7, fit + 2*se.fit)
LL_mod7 = with(pred_mod7, fit - 2*se.fit)

field_gcc_ndvi7 = mutate(field_gcc_ndvi, pred_mod7 = pred_mod7$fit, 
               ucl_mod7 = UL_mod7, 
               lcl_mod7 = LL_mod7)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod7 = ggplot(data = field_gcc_ndvi7, aes(x = tree_biomass_g_m, y = mean_ndvi_25cm)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod7), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod7, ymax = ucl_mod7, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod7), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod7), linetype='longdash', size = 1) +
    
    ylab("Mean NDVI (25cm)") +
    xlab("Biomass")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod7
```


## 8. Model: NDVIas  function of GCC
```{r}
mod8 = glm(mean_ndvi_50cm ~ tree_biomass_g_m, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod8.res = simulateResiduals(fittedModel = mod8, n = 500)
mod8.res$scaledResiduals
mod8.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod8.res)
```

```{r}
testDispersion(mod8.res)
```

### Sumamry
```{r}
summary(mod8)
```

```{r}
with(summary(mod8), 1 - deviance/null.deviance)
```

```{r}
data.frame(summary(lsmeans(mod8, ~ tree_biomass_g_m), type = "response"))
```

### Data for graph
```{r}
preddat_mod8 = data.frame(tree_biomass_g_m = field_gcc_ndvi$tree_biomass_g_m)

head(preddat_mod8)

pred_mod8 = predict(mod8, newdata = preddat_mod8, se.fit = TRUE)

UL_mod8 = with(pred_mod8, fit + 2*se.fit)
LL_mod8 = with(pred_mod8, fit - 2*se.fit)

field_gcc_ndvi8 = mutate(field_gcc_ndvi, pred_mod8 = pred_mod8$fit, 
               ucl_mod8 = UL_mod8, 
               lcl_mod8 = LL_mod8)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod8 = ggplot(data = field_gcc_ndvi8, aes(x = tree_biomass_g_m, y = mean_ndvi_50cm)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod8), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod8, ymax = ucl_mod8, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod8), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod8), linetype='longdash', size = 1) +
    
    ylab("Mean NDVI (50cm)") +
    xlab("Biomass")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod8
```

## 9. Model: NDVIas  function of GCC
```{r}
mod9 = glm(mean_ndvi_1m ~ tree_biomass_g_m, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod9.res = simulateResiduals(fittedModel = mod9, n = 500)
mod9.res$scaledResiduals
mod9.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod9.res)
```

```{r}
testDispersion(mod9.res)
```

### Sumamry
```{r}
summary(mod9)
```

```{r}
with(summary(mod9), 1 - deviance/null.deviance)
```

```{r}
data.frame(summary(lsmeans(mod9, ~ tree_biomass_g_m), type = "response"))
```

### Data for graph
```{r}
preddat_mod9 = data.frame(tree_biomass_g_m = field_gcc_ndvi$tree_biomass_g_m)

head(preddat_mod9)

pred_mod9 = predict(mod9, newdata = preddat_mod9, se.fit = TRUE)

UL_mod9 = with(pred_mod9, fit + 2*se.fit)
LL_mod9 = with(pred_mod9, fit - 2*se.fit)

field_gcc_ndvi9 = mutate(field_gcc_ndvi, pred_mod9 = pred_mod9$fit, 
               ucl_mod9 = UL_mod9, 
               lcl_mod9 = LL_mod9)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod9 = ggplot(data = field_gcc_ndvi9, aes(x = tree_biomass_g_m, y = mean_ndvi_1m)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod9), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod9, ymax = ucl_mod9, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod9), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod9), linetype='longdash', size = 1) +
    
    ylab("Mean NDVI (1m)") +
    xlab("Biomass")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod9
```

## 10. Model: NDVIas  function of GCC
```{r}
mod10 = glm(mean_ndvi_3m ~ tree_biomass_g_m, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod10.res = simulateResiduals(fittedModel = mod10, n = 500)
mod10.res$scaledResiduals
mod10.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod10.res)
```

```{r}
testDispersion(mod10.res)
```

### Sumamry
```{r}
summary(mod10)
```

```{r}
with(summary(mod10), 1 - deviance/null.deviance)
```

```{r}
data.frame(summary(lsmeans(mod10, ~ tree_biomass_g_m), type = "response"))
```

### Data for graph
```{r}
preddat_mod10 = data.frame(tree_biomass_g_m = field_gcc_ndvi$tree_biomass_g_m)

head(preddat_mod10)

pred_mod10 = predict(mod10, newdata = preddat_mod10, se.fit = TRUE)

UL_mod10 = with(pred_mod10, fit + 2*se.fit)
LL_mod10 = with(pred_mod10, fit - 2*se.fit)

field_gcc_ndvi10 = mutate(field_gcc_ndvi, pred_mod10 = pred_mod10$fit, 
               ucl_mod10 = UL_mod10, 
               lcl_mod10 = LL_mod10)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod10 = ggplot(data = field_gcc_ndvi10, aes(x = tree_biomass_g_m, y = mean_ndvi_3m)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod10), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod10, ymax = ucl_mod10, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod10), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod10), linetype='longdash', size = 1) +
    
    ylab("Mean NDVI (3m)") +
    xlab("Biomass")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod10
```

## 11. Model: NDVIas  function of GCC
```{r}
mod11 = glm(mean_ndvi_5m ~ tree_biomass_g_m, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod11.res = simulateResiduals(fittedModel = mod11, n = 500)
mod11.res$scaledResiduals
mod11.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod11.res)
```

```{r}
testDispersion(mod11.res)
```

### Sumamry
```{r}
summary(mod11)
```

```{r}
with(summary(mod11), 1 - deviance/null.deviance)
```

```{r}
data.frame(summary(lsmeans(mod11, ~ tree_biomass_g_m), type = "response"))
```

### Data for graph
```{r}
preddat_mod11 = data.frame(tree_biomass_g_m = field_gcc_ndvi$tree_biomass_g_m)

head(preddat_mod11)

pred_mod11 = predict(mod11, newdata = preddat_mod11, se.fit = TRUE)

UL_mod11 = with(pred_mod11, fit + 2*se.fit)
LL_mod11 = with(pred_mod11, fit - 2*se.fit)

field_gcc_ndvi11 = mutate(field_gcc_ndvi, pred_mod11 = pred_mod11$fit, 
               ucl_mod11 = UL_mod11, 
               lcl_mod11 = LL_mod11)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod11 = ggplot(data = field_gcc_ndvi11, aes(x = tree_biomass_g_m, y = mean_ndvi_5m)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod11), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod11, ymax = ucl_mod11, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod11), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod11), linetype='longdash', size = 1) +
    
    ylab("Mean NDVI (5m)") +
    xlab("Biomass")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod11
```

## 12. Model: NDVIas  function of GCC
```{r}
mod12 = glm(mean_ndvi_10m ~ tree_biomass_g_m, data = field_gcc_ndvi, family = gaussian)
```

### Residuals with DHARMa
```{r, include=FALSE}
mod12.res = simulateResiduals(fittedModel = mod12, n = 500)
mod12.res$scaledResiduals
mod12.res$scaledResidualsNormal
```

In the plot below we are looking for the points in the QQ plot to fall along the RED linen. In the Residuals vs.predicted plot were are looking for the lines to be relatively horizontal. All looks good. 
```{r}
plotSimulatedResiduals(simulationOutput = mod12.res)
```

```{r}
testDispersion(mod12.res)
```

### Sumamry

```{r}
summary(mod12)
```

```{r}
data.frame(summary(lsmeans(mod12, ~ tree_biomass_g_m), type = "response"))
```

### Data for graph
```{r}
preddat_mod12 = data.frame(tree_biomass_g_m = field_gcc_ndvi$tree_biomass_g_m)

head(preddat_mod12)

pred_mod12 = predict(mod12, newdata = preddat_mod12, se.fit = TRUE)

UL_mod12 = with(pred_mod12, fit + 2*se.fit)
LL_mod12 = with(pred_mod12, fit - 2*se.fit)

field_gcc_ndvi12 = mutate(field_gcc_ndvi, pred_mod12 = pred_mod12$fit, 
               ucl_mod12 = UL_mod12, 
               lcl_mod12 = LL_mod12)
```

### Graph 

```{r fig.height=3, fig.width=3}
plot_mod12 = ggplot(data = field_gcc_ndvi12, aes(x = tree_biomass_g_m, y = mean_ndvi_10m)) + 
    geom_point(size = 2) +  
    geom_line(aes(y = pred_mod12), linetype = 1, size = 2) + 
    geom_ribbon( aes(ymin = lcl_mod12, ymax = ucl_mod12, color = NULL, show.legend = FALSE), alpha = .15) +
    geom_line(aes(y= lcl_mod12), linetype = 'longdash', size = 1) + 
    geom_line(aes(y=ucl_mod12), linetype='longdash', size = 1) +
    
    ylab("Mean NDVI  (10m)") +
    xlab("Biomass")  +
    reg_theme +  guides(color=guide_legend(override.aes=list(fill=NA))) 

plot_mod12
```



```{r}
compareGLM(mod7, mod8, mod9, mod10, mod11, mod12)
```

# Manuscript Figures 



```{r fig.height=7, fig.width=6}

grid_biomass_gcc = cowplot::plot_grid(plot_mod1, plot_mod2, plot_mod3, plot_mod4, plot_mod5, plot_mod6,   labels = c("A", "B", "C", "D", "E", "F"), align = "hv", ncol= 2) 
grid_biomass_gcc

```
```{r eval=FALSE, include=FALSE}
ggsave("../figures/2020-05-13_Biomass-tree-gcc.jpeg", plot = grid_biomass_gcc, width = 6, height = 7, units = c("in"), dpi=600 )
```

```{r fig.height=7, fig.width=6}

grid_biomass_ndvi = cowplot::plot_grid(plot_mod7, plot_mod8, plot_mod9, plot_mod10, plot_mod11, plot_mod12, labels = c("A", "B", "C", "D", "E", "F"), align = "hv", ncol= 2) 
grid_biomass_ndvi

```

```{r eval=FALSE, include=FALSE}
ggsave("../figures/2020-05-13_Biomass-tree-ndvi.jpeg", plot = grid_biomass_ndvi, width = 6, height = 7, units = c("in"), dpi=600 )
```

```{r fig.height=7, fig.width=6}

grid_biomass = cowplot::plot_grid(plot_mod1, plot_mod7, plot_mod2, plot_mod8, plot_mod3, plot_mod9, plot_mod4, plot_mod10, plot_mod5, plot_mod11, plot_mod6, plot_mod12, labels = c("A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L"), align = "hv", ncol= 2) 
grid_biomass

```

```{r eval=FALSE, include=FALSE}
ggsave("../figures/2020-05-13_Biomass-gcc.jpeg", plot = , width = 6, height = 7, units = c("in"), dpi=600 )
```
