---
title: "GCC and Field Data"
author: "Anna Talucci"
date: "2/24/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Overview

- Evaluated the relationship between GCC and distance from the unburned edge 



- Plot size for field data collection was variable from 4-10m radius plots
- apply 4m buffer

# Packages
```{r, include=FALSE}
library(sp) 
library(rgdal) 
library(raster) 
library(rgeos) # GIS Geometry
library(foreign) # deals with dbf files
library(dplyr)
library(ggplot2)
library(tidyr)
```


# RGB DATA



alnus_tr1_f07
ans_tr2_f04
ans_tr3_f06
brp_tr1_f09
brp_tr2_f12
cn_tr2_f17
cn_tr1_f15 


# GCC rasters

```{r}
alnus_tr1_f07 = raster("../data/gcc/alnus_tr1_f07_gcc.tif")
ans_tr2_f04 = raster("../data/gcc/ans_tr2_f04_gcc.tif")
ans_tr3_f06 = raster("../data/gcc/ans_tr3_f06_gcc.tif")
brp_tr1_f09 = raster("../data//gcc/brp_tr1_f09_gcc.tif")
brp_tr2_f12 = raster("../data/gcc/brp_tr2_f12_gcc.tif")
cn_tr2_f17 = raster("../data/gcc/cn_tr2_f17_gcc.tif")
cn_tr1_f15 = raster("../data/gcc/cn_tr1_f15_gcc.tif")
```


# Field points and buffers
hs2001 = readOGR("../data/hotspot_data/DL_FIRE_M6_2001/fire_archive_2001.shp", "fire_archive_2001")

## Point Data

Points
```{r}
alnus_tr1_pt = readOGR("../data/field-spatial/point/alnus_tr1_ee_pt.shp", "alnus_tr1_ee_pt")
ans_tr2_pt = readOGR("../data/field-spatial/point/ans_tr2_ee_pt.shp", "ans_tr2_ee_pt") 
ans_tr3_pt = readOGR("../data/field-spatial/point/ans_tr3_ee_pt.shp", "ans_tr3_ee_pt") 
brp_tr1_pt = readOGR("../data/field-spatial/point/bp_tr1_ee_pt.shp", "bp_tr1_ee_pt") 
brp_tr2_pt = readOGR("../data/field-spatial/point/bp_tr2_ee_pt.shp", "bp_tr2_ee_pt") 
cn_tr1_pt = readOGR("../data/field-spatial/point/cn_tr1_ee_pt.shp", "cn_tr1_ee_pt") 
cn_tr2_pt = readOGR("../data/field-spatial/point/cn_tr2_ee_pt.shp", "cn_tr2_ee_pt") 
```

```{r}
alnus_tr1_pt
```

```{r}
ans_tr2_pt
```

```{r}
ans_tr3_pt
```

```{r}
brp_tr1_pt
```

```{r}
brp_tr2_pt
```

```{r}
cn_tr1_pt
```

```{r}
cn_tr2_pt
```


## 1m - extract mean pixel values
Use 1m buffer for GCC as  function of distance from edge
extract(rasterA,points, buffer=150, fun=mean)

- Choose buffer based on pixel size and maintaining fine scale resolution but aggregating so that values are at the same spatial scale

```{r}

extract_alnus_tr1 = raster::extract(alnus_tr1_f07, alnus_tr1_pt, buffer=1, fun=mean, df=TRUE )
extract_ans_tr2 = raster::extract(ans_tr2_f04, ans_tr2_pt, buffer=1, fun=mean, df=TRUE )
extract_ans_tr3 = raster::extract(ans_tr3_f06, ans_tr3_pt, buffer=1, fun=mean,  df=TRUE )
extract_brp_tr1 = raster::extract(brp_tr1_f09, brp_tr1_pt, buffer=1, fun=mean, df=TRUE )
extract_brp_tr2 = raster::extract(brp_tr2_f12, brp_tr2_pt, buffer=1, fun=mean,  df=TRUE )
extract_cn_tr1 = raster::extract(cn_tr1_f15, cn_tr1_pt, buffer=1, fun=mean,  df=TRUE )
extract_cn_tr2 = raster::extract(cn_tr2_f17, cn_tr2_pt, buffer=1, fun=mean,  df=TRUE )
```


```{r}
extract_alnus_tr1$plot_id = alnus_tr1_pt$ID
names(extract_alnus_tr1) = c('ID', 'mean_gcc_1m', 'plot_id')
extract_alnus_tr1
```

```{r}
extract_ans_tr2$plot_id = ans_tr2_pt$ID
names(extract_ans_tr2) = c('ID', 'mean_gcc_1m', 'plot_id')
extract_ans_tr2
```

```{r}
extract_ans_tr3$plot_id = ans_tr3_pt$ID
names(extract_ans_tr3) = c('ID', 'mean_gcc_1m', 'plot_id')
extract_ans_tr3
```


```{r}
extract_brp_tr1$plot_id = brp_tr1_pt$ID
names(extract_brp_tr1) = c('ID', 'mean_gcc_1m', 'plot_id')
extract_brp_tr1
```

```{r}
extract_brp_tr2$plot_id = brp_tr2_pt$ID
names(extract_brp_tr2) = c('ID', 'mean_gcc_1m', 'plot_id')
extract_brp_tr2
```

```{r}
extract_cn_tr1$plot_id = cn_tr1_pt$ID
names(extract_cn_tr1) = c('ID', 'mean_gcc_1m', 'plot_id')
extract_cn_tr1
```

```{r}
extract_cn_tr2$plot_id = cn_tr2_pt$ID
names(extract_cn_tr2) = c('ID', 'mean_gcc_1m', 'plot_id')
extract_cn_tr2
```
extract_alnus_tr1, extract_ans_tr2, extract_ans_tr3, extract_brp_tr1, extract_brp_tr2, extract_cn_tr1, extract_cn_tr2
```{r}
gcc_1m = bind_rows(extract_alnus_tr1, extract_ans_tr2, extract_ans_tr3, extract_brp_tr1, extract_brp_tr2, extract_cn_tr1, extract_cn_tr2) %>% dplyr::select(plot_id, mean_gcc_1m) %>% rename(ID = plot_id)
length(unique(gcc_3m$ID))
gcc_1m
```

```{r eval=FALSE, include=FALSE}
ans_bind = rbind(extract_ans_tr2, extract_ans_tr3)
brp_bind = rbind( extract_brp_tr1, extract_brp_tr2)
cn_bind = rbind(extract_cn_tr1, extract_cn_tr2)
alnus_ans = rbind(extract_alnus_tr1, ans_bind)
brp_cn = rbind(brp_bind, cn_bind)
gcc_1m = rbind(alnus_ans, brp_cn)
gcc_1m = gcc_1m %>% dplyr::select(plot_id, mean_gcc_1m) %>% rename(ID = plot_id)
gcc_1m
```

```{r}
write.csv(gcc_1m,"../outputs/extracted_data/gcc_1m.csv", row.names = FALSE)
```

## 3m - extract mean pixel values
Use 1m buffer for GCC as  function of distance from edge
extract(rasterA,points, buffer=150, fun=mean)

- Choose buffer based on pixel size and maintaining fine scale resolution but aggregating so that values are at the same spatial scale

```{r}

extract_alnus_tr1_3m = raster::extract(alnus_tr1_f07, alnus_tr1_pt, buffer=3, fun=mean, df=TRUE )
extract_ans_tr2_3m = raster::extract(ans_tr2_f04, ans_tr2_pt, buffer=3, fun=mean, df=TRUE )
extract_ans_tr3_3m = raster::extract(ans_tr3_f06, ans_tr3_pt, buffer=3, fun=mean,  df=TRUE )
extract_brp_tr1_3m = raster::extract(brp_tr1_f09, brp_tr1_pt, buffer=3, fun=mean, df=TRUE )
extract_brp_tr2_3m = raster::extract(brp_tr2_f12, brp_tr2_pt, buffer=3, fun=mean,  df=TRUE )
extract_cn_tr1_3m = raster::extract(cn_tr1_f15, cn_tr1_pt, buffer=3, fun=mean,  df=TRUE )
extract_cn_tr2_3m = raster::extract(cn_tr2_f17, cn_tr2_pt, buffer=3, fun=mean,  df=TRUE )
```


```{r}
extract_alnus_tr1_3m$plot_id = alnus_tr1_pt$ID
names(extract_alnus_tr1_3m) = c('ID', 'mean_gcc_3m', 'plot_id')
extract_alnus_tr1_3m
```

```{r}
extract_ans_tr2_3m$plot_id = ans_tr2_pt$ID
names(extract_ans_tr2_3m) = c('ID', 'mean_gcc_3m', 'plot_id')
extract_ans_tr2_3m
```

```{r}
extract_ans_tr3_3m$plot_id = ans_tr3_pt$ID
names(extract_ans_tr3_3m) = c('ID', 'mean_gcc_3m', 'plot_id')
extract_ans_tr3_3m
```


```{r}
extract_brp_tr1_3m$plot_id = brp_tr1_pt$ID
names(extract_brp_tr1_3m) = c('ID', 'mean_gcc_3m', 'plot_id')
extract_brp_tr1_3m
```

```{r}
extract_brp_tr2_3m$plot_id = brp_tr2_pt$ID
names(extract_brp_tr2_3m) = c('ID', 'mean_gcc_3m', 'plot_id')
extract_brp_tr2_3m
```

```{r}
extract_cn_tr1_3m$plot_id = cn_tr1_pt$ID
names(extract_cn_tr1_3m) = c('ID', 'mean_gcc_3m', 'plot_id')
extract_cn_tr1_3m
```

```{r}
extract_cn_tr2_3m$plot_id = cn_tr2_pt$ID
names(extract_cn_tr2_3m) = c('ID', 'mean_gcc_3m', 'plot_id')
extract_cn_tr2_3m
```
extract_alnus_tr1, extract_ans_tr2, extract_ans_tr3, extract_brp_tr1, extract_brp_tr2, extract_cn_tr1, extract_cn_tr2

```{r}
gcc_3m = bind_rows(extract_alnus_tr1_3m, extract_ans_tr2_3m, extract_ans_tr3_3m, extract_brp_tr1_3m, extract_brp_tr2_3m, extract_cn_tr1_3m, extract_cn_tr2_3m) %>% dplyr::select(plot_id, mean_gcc_3m) %>% rename(ID = plot_id)
length(unique(gcc_3m$ID))
gcc_3m
```


```{r eval=FALSE, include=FALSE}
ans_bind_3m = rbind(extract_ans_tr2_3m, extract_ans_tr3_3m)
brp_bind_3m = rbind( extract_brp_tr1_3m, extract_brp_tr2_3m)
cn_bind_3m = rbind(extract_cn_tr1_3m, extract_cn_tr2_3m)
alnus_ans_3m = rbind(extract_alnus_tr1_3m, ans_bind_3m)
brp_cn_3m = rbind(brp_bind_3m, cn_bind_3m)
gcc_3m = rbind(alnus_ans_3m, brp_cn_3m)
gcc_3m = gcc_3m %>% dplyr::select(plot_id, mean_gcc_3m) %>% rename(ID = plot_id)
gcc_3m
```

```{r}
write.csv(gcc_3m,"../outputs/extracted_data/gcc_3m.csv", row.names = FALSE)
```

## .25m - extract mean pixel values
Use 1m buffer for GCC as  function of distance from edge
extract(rasterA,points, buffer=150, fun=mean)

- Choose buffer based on pixel size and maintaining fine scale resolution but aggregating so that values are at the same spatial scale

```{r}

extract_alnus_tr1_qm = raster::extract(alnus_tr1_f07, alnus_tr1_pt, buffer=.25, fun=mean, df=TRUE )
extract_ans_tr2_qm = raster::extract(ans_tr2_f04, ans_tr2_pt, buffer=.25, fun=mean, df=TRUE )
extract_ans_tr3_qm = raster::extract(ans_tr3_f06, ans_tr3_pt, buffer=.25, fun=mean,  df=TRUE )
extract_brp_tr1_qm = raster::extract(brp_tr1_f09, brp_tr1_pt, buffer=.25, fun=mean, df=TRUE )
extract_brp_tr2_qm = raster::extract(brp_tr2_f12, brp_tr2_pt, buffer=.25, fun=mean,  df=TRUE )
extract_cn_tr1_qm = raster::extract(cn_tr1_f15, cn_tr1_pt, buffer=.25, fun=mean,  df=TRUE )
extract_cn_tr2_qm = raster::extract(cn_tr2_f17, cn_tr2_pt, buffer=.25, fun=mean,  df=TRUE )
```


```{r}
extract_alnus_tr1_qm$plot_id = alnus_tr1_pt$ID
names(extract_alnus_tr1_qm) = c('ID', 'mean_gcc_25cm', 'plot_id')
extract_alnus_tr1_qm
```

```{r}
extract_ans_tr2_qm$plot_id = ans_tr2_pt$ID
names(extract_ans_tr2_qm) = c('ID', 'mean_gcc_25cm', 'plot_id')
extract_ans_tr2_qm
```

```{r}
extract_ans_tr3_qm$plot_id = ans_tr3_pt$ID
names(extract_ans_tr3_qm) = c('ID', 'mean_gcc_25cm', 'plot_id')
extract_ans_tr3_qm
```


```{r}
extract_brp_tr1_qm$plot_id = brp_tr1_pt$ID
names(extract_brp_tr1_qm) = c('ID', 'mean_gcc_25cm', 'plot_id')
extract_brp_tr1_qm
```

```{r}
extract_brp_tr2_qm$plot_id = brp_tr2_pt$ID
names(extract_brp_tr2_qm) = c('ID', 'mean_gcc_25cm', 'plot_id')
extract_brp_tr2_qm
```

```{r}
extract_cn_tr1_qm$plot_id = cn_tr1_pt$ID
names(extract_cn_tr1_qm) = c('ID', 'mean_gcc_25cm', 'plot_id')
extract_cn_tr1_qm
```

```{r}
extract_cn_tr2_qm$plot_id = cn_tr2_pt$ID
names(extract_cn_tr2_qm) = c('ID', 'mean_gcc_25cm', 'plot_id')
extract_cn_tr2_qm
```
extract_alnus_tr1, extract_ans_tr2, extract_ans_tr3, extract_brp_tr1, extract_brp_tr2, extract_cn_tr1, extract_cn_tr2





```{r}
gcc_qm = bind_rows(extract_alnus_tr1_qm, extract_ans_tr2_qm, extract_ans_tr3_qm, extract_brp_tr1_qm, extract_brp_tr2_qm, extract_cn_tr1_qm, extract_cn_tr2_qm) %>% dplyr::select(plot_id, mean_gcc_25cm) %>% rename(ID = plot_id)
length(unique(gcc$ID))
gcc_qm
```



```{r eval=FALSE, include=FALSE}
ans_bind_qm = rbind(extract_ans_tr2_qm, extract_ans_tr3_qm)
brp_bind_qm = rbind( extract_brp_tr1_qm, extract_brp_tr2_qm)
cn_bind_qm = rbind(extract_cn_tr1_qm, extract_cn_tr2_qm)
alnus_ans_qm = rbind(extract_alnus_tr1_qm, ans_bind_qm)
brp_cn_qm = rbind(brp_bind_qm, cn_bind_qm)
gcc_qm1 = rbind(alnus_ans_qm, brp_cn_qm)
gcc_qm1
length(unique(gcc_qm1$plot_id))
gcc_qm = gcc_qm1 %>% dplyr::select(plot_id, mean_gcc_25cm) %>% rename(ID = plot_id)
gcc_qm
```

```{r}
write.csv(gcc_qm,"../outputs/extracted_data/gcc_25cm.csv", row.names = FALSE)
```

## Trees -variable plot size extract mean pixel values
Use 1m buffer for GCC as  function of distance from edge
extract(rasterA,points, buffer=150, fun=mean)

- Choose buffer based on pixel size and maintaining fine scale resolution but aggregating so that values are at the same spatial scale
```{r}
names(alnus_tr1_pt)
```

```{r}

extract_alnus_tr1_tree = raster::extract(alnus_tr1_f07, alnus_tr1_pt, buffer=alnus_tr1_pt$radius, fun=mean, df=TRUE )
extract_ans_tr2_tree = raster::extract(ans_tr2_f04, ans_tr2_pt, buffer=alnus_tr1_pt$radius, fun=mean, df=TRUE )
extract_ans_tr3_tree = raster::extract(ans_tr3_f06, ans_tr3_pt, buffer=alnus_tr1_pt$radius, fun=mean,  df=TRUE )
extract_brp_tr1_tree = raster::extract(brp_tr1_f09, brp_tr1_pt, buffer=alnus_tr1_pt$radius, fun=mean, df=TRUE )
extract_brp_tr2_tree = raster::extract(brp_tr2_f12, brp_tr2_pt, buffer=alnus_tr1_pt$radius, fun=mean,  df=TRUE )
extract_cn_tr1_tree = raster::extract(cn_tr1_f15, cn_tr1_pt, buffer=alnus_tr1_pt$radius, fun=mean,  df=TRUE )
extract_cn_tr2_tree = raster::extract(cn_tr2_f17, cn_tr2_pt, buffer=alnus_tr1_pt$radius, fun=mean,  df=TRUE )
```


```{r}
extract_alnus_tr1_tree$plot_id = alnus_tr1_pt$ID
names(extract_alnus_tr1_tree) = c('ID', 'mean_gcc_tree', 'plot_id')
extract_alnus_tr1_tree
```

```{r}
extract_ans_tr2_tree$plot_id = ans_tr2_pt$ID
names(extract_ans_tr2_tree) = c('ID', 'mean_gcc_tree', 'plot_id')
extract_ans_tr2_tree
```

```{r}
extract_ans_tr3_tree$plot_id = ans_tr3_pt$ID
names(extract_ans_tr3_tree) = c('ID', 'mean_gcc_tree', 'plot_id')
extract_ans_tr3_tree
```


```{r}
extract_brp_tr1_tree$plot_id = brp_tr1_pt$ID
names(extract_brp_tr1_tree) = c('ID', 'mean_gcc_tree', 'plot_id')
extract_brp_tr1_tree
```

```{r}
extract_brp_tr2_tree$plot_id = brp_tr2_pt$ID
names(extract_brp_tr2_tree) = c('ID', 'mean_gcc_tree', 'plot_id')
extract_brp_tr2_tree
```

```{r}
extract_cn_tr1_tree$plot_id = cn_tr1_pt$ID
names(extract_cn_tr1_tree) = c('ID', 'mean_gcc_tree', 'plot_id')
extract_cn_tr1_tree
```

```{r}
extract_cn_tr2_tree$plot_id = cn_tr2_pt$ID
names(extract_cn_tr2_tree) = c('ID', 'mean_gcc_tree', 'plot_id')
extract_cn_tr2_tree
```
extract_alnus_tr1, extract_ans_tr2, extract_ans_tr3, extract_brp_tr1, extract_brp_tr2, extract_cn_tr1, extract_cn_tr2





```{r}
gcc_tree = bind_rows(extract_alnus_tr1_tree, extract_ans_tr2_tree, extract_ans_tr3_tree, extract_brp_tr1_tree, extract_brp_tr2_tree, extract_cn_tr1_tree, extract_cn_tr2_tree) %>% dplyr::select(plot_id, mean_gcc_tree) %>% rename(ID = plot_id)
length(unique(gcc_tree$ID))
gcc_tree
```


```{r}
write.csv(gcc_tree,"../outputs/extracted_data/gcc_tree.csv", row.names = FALSE)
```

## Shrub -variable plot size extract mean pixel values
```{r}

extract_alnus_tr1_shrub = raster::extract(alnus_tr1_f07, alnus_tr1_pt, buffer=alnus_tr1_pt$radius, fun=mean, df=TRUE )
extract_ans_tr2_shrub = raster::extract(ans_tr2_f04, ans_tr2_pt, buffer=alnus_tr1_pt$radius, fun=mean, df=TRUE )
extract_ans_tr3_shrub = raster::extract(ans_tr3_f06, ans_tr3_pt, buffer=alnus_tr1_pt$radius, fun=mean,  df=TRUE )
extract_brp_tr1_shrub = raster::extract(brp_tr1_f09, brp_tr1_pt, buffer=alnus_tr1_pt$radius, fun=mean, df=TRUE )
extract_brp_tr2_shrub = raster::extract(brp_tr2_f12, brp_tr2_pt, buffer=alnus_tr1_pt$radius, fun=mean,  df=TRUE )
extract_cn_tr1_shrub = raster::extract(cn_tr1_f15, cn_tr1_pt, buffer=alnus_tr1_pt$radius, fun=mean,  df=TRUE )
extract_cn_tr2_shrub = raster::extract(cn_tr2_f17, cn_tr2_pt, buffer=alnus_tr1_pt$radius, fun=mean,  df=TRUE )
```


```{r}
extract_alnus_tr1_shrub$plot_id = alnus_tr1_pt$ID
names(extract_alnus_tr1_shrub) = c('ID', 'mean_gcc_shrub', 'plot_id')
extract_alnus_tr1_shrub
```

```{r}
extract_ans_tr2_shrub$plot_id = ans_tr2_pt$ID
names(extract_ans_tr2_shrub) = c('ID', 'mean_gcc_shrub', 'plot_id')
extract_ans_tr2_shrub
```

```{r}
extract_ans_tr3_shrub$plot_id = ans_tr3_pt$ID
names(extract_ans_tr3_shrub) = c('ID', 'mean_gcc_shrub', 'plot_id')
extract_ans_tr3_shrub
```


```{r}
extract_brp_tr1_shrub$plot_id = brp_tr1_pt$ID
names(extract_brp_tr1_shrub) = c('ID', 'mean_gcc_shrub', 'plot_id')
extract_brp_tr1_shrub
```

```{r}
extract_brp_tr2_shrub$plot_id = brp_tr2_pt$ID
names(extract_brp_tr2_shrub) = c('ID', 'mean_gcc_shrub', 'plot_id')
extract_brp_tr2_shrub
```

```{r}
extract_cn_tr1_shrub$plot_id = cn_tr1_pt$ID
names(extract_cn_tr1_shrub) = c('ID', 'mean_gcc_shrub', 'plot_id')
extract_cn_tr1_shrub
```

```{r}
extract_cn_tr2_shrub$plot_id = cn_tr2_pt$ID
names(extract_cn_tr2_shrub) = c('ID', 'mean_gcc_shrub', 'plot_id')
extract_cn_tr2_shrub
```
extract_alnus_tr1, extract_ans_tr2, extract_ans_tr3, extract_brp_tr1, extract_brp_tr2, extract_cn_tr1, extract_cn_tr2





```{r}
gcc_shrub = bind_rows(extract_alnus_tr1_shrub, extract_ans_tr2_shrub, extract_ans_tr3_shrub, extract_brp_tr1_shrub, extract_brp_tr2_shrub, extract_cn_tr1_shrub, extract_cn_tr2_shrub) %>% dplyr::select(plot_id, mean_gcc_shrub) %>% rename(ID = plot_id)
length(unique(gcc_shrub$ID))
gcc_shrub
```


```{r}
write.csv(gcc_shrub,"../outputs/extracted_data/gcc_shrub.csv", row.names = FALSE)
```


# COmbine gcc data

```{r}
gcc_merge1 = merge(gcc_1m, gcc_3m,  by= "ID")
gcc_merge1
gcc_merge2 = merge(gcc_merge1, gcc_qm,  by="ID")
gcc_merge3 = merge(gcc_tree, gcc_shrub, by="ID")
gcc = merge(gcc_merge2, gcc_merge3, by="ID")
gcc
```


```{r}
write.csv(gcc,"../outputs/extracted_data/gcc_all.csv", row.names = FALSE)
```